name: Claude Code

on:
  issues:
    types: [assigned]

jobs:
  analyze:
    if: github.event.action == 'assigned' && github.event.assignee.login == 'boshen' && github.event.sender.login == 'boshen'
    runs-on: ubuntu-slim
    permissions:
      contents: read
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          fetch-depth: 100
          persist-credentials: true

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@6c61301d8e1ee91bef7b65172f93462bbb216394 # v1.0.46
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          assignee_trigger: "boshen"
          claude_args: --allowedTools "Edit,Write,Read,Glob,Grep,Bash(gh:*),Bash(cargo:*),Bash(git:*),Bash(just:*),WebFetch,TodoWrite"
          prompt: |
            Analyze issue #${{ github.event.issue.number }} in ${{ github.repository }} and determine if it can be fixed.

            First, use `gh issue view ${{ github.event.issue.number }}` to read the issue details.

            Then:
            1. Search the codebase to gather relevant context (related files, existing implementations, tests)
            2. Determine if the issue is fixable and estimate the complexity

            Finally, post a comment on the issue with:
            - A brief summary of your understanding of the issue
            - Relevant files/code you found
            - Whether this issue is fixable (yes/no/needs clarification)
            - If the issue is unclear, ask for more context
            - If fixable, provide a concrete implementation plan with specific steps
            - Any potential concerns or blockers
