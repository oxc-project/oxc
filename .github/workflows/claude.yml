name: Claude Code

on:
  issues:
    types: [assigned]

jobs:
  claude:
    if: github.event.assignee.login == 'boshen' && github.event.sender.login == 'boshen'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          fetch-depth: 1
          persist-credentials: false

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@a017b830c03e23789b11fb69ed571ea61c12e45c # v1.0.30
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          assignee_trigger: "boshen"
          prompt: |
            Analyze this issue and determine if it can be fixed. Your task:
            1. Read and understand the issue description
            2. Search the codebase to gather relevant context (related files, existing implementations, tests)
            3. Determine if the issue is fixable and estimate the complexity
            4. Comment on the issue with:
               - A brief summary of your understanding of the issue
               - Relevant files/code you found
               - Whether this issue is fixable (yes/no/needs clarification)
               - Ask for more context if the issue is unclear
               - If fixable, provide a concrete implementation plan with specific steps
               - Any potential concerns or blockers
